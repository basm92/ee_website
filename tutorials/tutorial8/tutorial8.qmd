---
title: "Empirical Economics"
subtitle: "Tutorial 8: Instrumental Variables"
mainfont: Lato
monofont: Ubuntu Mono
format:
  revealjs: 
    slide-number: true
    chalkboard: 
      buttons: false
    preview-links: auto
    logo: logo.svg
    css: styles.css
    footer: 'Empirical Economics: Tutorial 8 - Instrumental Variables'
resources:
  - demo.pdf
---

```{r setup}
#| warning: false
#| message: false
#| echo: false

library(tidyverse)
library(gridExtra)
library(here)
library(reticulate)
python_path <- here::here(".venv", "bin", "python")
use_python(python_path)
```

# Tutorial 8

# Course Evaluations

## Course Evaluations

We would really like you to take the time to fill out the course evaluation form. Your feedback is very important to us and helps us improve the course for future students.

You can fill it in on [https://entry.caracal.uu.nl/44007](https://entry.caracal.uu.nl/44007) under "Course Evaluations" or scan the QR code:

![](course_eval.png){fig-align="center"}


## Recapitulation of the Lecture

## Slide 1

## Slide 2

# Questions

## Estimating the AJR Model

A researcher has obtained a simplified version of the dataset used by Acemoglu, Johnson, and Robinson (2001). The dataset, colonial_data, contains the following key variables for a sample of former colonies:

  - `log_gdp_95`: Log of GDP per capita in 1995 (the outcome variable, Y).
  - `avg_exprop`: An index of "protection against expropriation risk" averaged from 1985-1995. This measures the quality of institutions (the endogenous variable, X).
  - `log_settler_mortality`: The log of the mortality rate for European settlers in the 19th century (the instrumental variable, Z).
  - `africa`: A dummy whether a country is in Africa, a control variable.

## Estimating the AJR Model (Cont.)

The researcher runs four different regressions to analyze the relationship between institutions and economic development. The code and simplified outputs are provided below.

::: {.panel-tabset}

### R

```{r}
#| echo: true
#| code-fold: true
#| collapse: true
library(AER)
colonial_data <- readr::read_csv2("../datafiles/colonial_origins.csv")
# Model 1: OLS
ols_model <- lm(logpgp95 ~ avexpr + africa, data = colonial_data)

# Model 2: Reduced Form
reduced_form <- lm(logpgp95 ~ logem4 + africa, data = colonial_data)

# Model 3: First Stage
first_stage <- lm(avexpr ~ logem4 + africa, data = colonial_data)

# Model 4: 2SLS / IV
iv_model <- ivreg(logpgp95 ~ avexpr + africa | logem4 + africa, data = colonial_data)
summary(iv_model, diagnostics = TRUE) # To get the F-statistic
```

### Python

```{python}
#| echo: true
#| code-fold: true
#| collapse: true
import statsmodels.formula.api as smf
from linearmodels.iv import IV2SLS
import pandas as pd

colonial_data = pd.read_csv('../datafiles/colonial_origins.csv', decimal=',', sep=";")
# Model 1: OLS
ols_model = smf.ols('logpgp95 ~ avexpr + africa', data=colonial_data).fit()

# Model 2: Reduced Form
reduced_form = smf.ols('logpgp95 ~ logem4 + africa', data=colonial_data).fit()

# Model 3: First Stage
first_stage = smf.ols('avexpr ~ logem4 + africa', data=colonial_data).fit()

# Model 4: 2SLS / IV
iv_model = IV2SLS.from_formula('logpgp95 ~ 1 + africa + [avexpr ~ logem4]', data=colonial_data).fit()
print(iv_model)
```

### Stata

```{stata}
#| echo: true
#| eval: false
#| code-fold: true
* Model 1: OLS
reg log_gdp_95 avg_exprop lat

* Model 2: Reduced Form
reg log_gdp_95 log_settler_mortality lat

* Model 3: First Stage
reg avg_exprop log_settler_mortality lat

* Model 4: 2SLS / IV
ivregress 2sls log_gdp_95 lat (avg_exprop = log_settler_mortality)
* To get the first-stage F-statistic
estat firststage
```

:::

:::{style="font-size: 0.7em;"}

a) Verify the IV Estimate: The lecture shows that the IV estimator can be calculated as the ratio of the Reduced Form effect to the First Stage effect. Using the coefficients from columns (2) and (3), manually calculate this ratio. Does your result match the coefficient for avg_exprop in the 2SLS model in column (4)?

b) Compare OLS and 2SLS: The 2SLS estimate for the effect of institutions (0.96) is significantly larger than the OLS estimate (0.52). What does this suggest about the direction of the omitted variable bias in the OLS model? Provide a brief economic explanation for why this might be the case.

c) Assess Instrument Strength: Based on the results provided in the table, is settler mortality a weak instrument for institutions? Justify your answer using the relevant statistic.

d) Interpret the LATE: The 2SLS estimate is a Local Average Treatment Effect (LATE). Describe, in the context of this study, the specific subgroup of countries for which this estimate represents the causal effect of institutions on economic development.

:::


## Colonial Origins IV Strategy

Acemoglu, Johnson, and Robinson (2001) want to estimate the causal effect of institutions ($X$) on long-run economic development (Y, measured by log GDP per capita). They know that OLS is likely biased. They propose using the mortality rates of early European settlers ($Z$) as an instrumental variable for current institutions.

  a) **Relevance:** Clearly explain the "first stage" logic. By what mechanism did settler mortality rates influence the type of institutions that were established in a colony?
  
  b) **Exclusion Restriction:** State the exclusion restriction in the context of this study. What must be true about settler mortality for it to be a valid instrument?
  
  c) **LATE:** In this context, who are the "compliers"? What does the LATE estimated by this IV strategy represent?

## Defending and Challenging the Exclusion Restriction

The credibility of the Acemoglu et al. (2001) paper rests on the validity of the exclusion restriction.

  a) Provide a strong argument to **defend** the exclusion restriction. Why is it plausible that 19th-century settler mortality has no direct effect on 21st-century GDP, other than through its effect on the development of institutions?
  
  b) Provide a plausible counterargument that could **violate** the exclusion restriction. Propose a specific channel through which early settler mortality might affect current GDP that does *not* run through political institutions. (For example, think about the disease environment or human capital).


## Interpreting 2SLS Results

Below is a simplified table of results from the Acemoglu et al. (2001) paper. "Protection Against Expropriation" is the measure for institutions.

| **Panel A: First Stage** |  |
| :--- |:--- |
| Dependent Variable: | Protection Against Expropriation |
| Log Settler Mortality | -0.61*** |
| (Constant) | 9.32*** |
| *Observations* | *64* |
| *F-statistic on excluded instrument* | *14.9* |

| **Panel B: 2SLS** |  |
| :--- | :--- |
| Dependent Variable: | Log GDP per capita, 1995 |
| Protection Against Expropriation | 0.94*** |
| (Constant) | 1.91 |

  a) Interpret the coefficient on "Log Settler Mortality" in the First Stage (Panel A). Does this result support the relevance condition? How does the F-statistic inform your answer?
  
  b) Interpret the coefficient on "Protection Against Expropriation" in the 2SLS regression (Panel B). What is the economic significance of this estimate?
  
  c) Based on the signs of the coefficients in both panels, what must be the sign of the "Reduced Form" relationship (the regression of Log GDP per capita on Log Settler Mortality)? Explain your reasoning.

## Designing an Alternative IV Study

Imagine a researcher is unconvinced by the settler mortality instrument. She wants to re-test the Acemoglu et al. (2001) hypothesis using a different IV strategy for the effect of institutions on development.

Propose a new, potential instrumental variable for "quality of institutions". Justify your choice by carefully explaining:

  1.  Why you believe it would be **relevant** (correlated with institutions).
  2.  How you would defend its **validity** (the exclusion restriction).
  3.  What potential weaknesses or criticisms your proposed instrument might face.

## Deriving the IV Estimator

Consider the linear model $Y_i = \beta_0 + \beta_1 X_i + \epsilon_i$, where $Cov(X_i, \epsilon_i) \neq 0$. You have a valid instrument $Z_i$ which satisfies the relevance condition, $Cov(Z_i, X_i) \neq 0$, and the exclusion restriction, $Cov(Z_i, \epsilon_i) = 0$.

Starting from the model equation, use the exclusion restriction to show that the IV estimator for $\beta_1$ is given by:
$$ \hat{\beta}_1^{\text{IV}} = \frac{Cov(Z, Y)}{Cov(Z, X)} $$
*(Hint: Start by taking the covariance of the entire model equation with respect to Z).*

## The Wald Estimator

Imagine a population where individuals are classified based on their response to an encouragement design (an instrument, Z):

  - **Never-Takers (40% of the population):** They never get the treatment (X=0), regardless of encouragement (Z). Their average outcome is 30.
  - **Always-Takers (20% of the population):** They always get the treatment (X=1), regardless of encouragement. Their average outcome is 50.
  - **Compliers (40% of the population):** They get the treatment only if encouraged (X=1 if Z=1, X=0 if Z=0). If they are treated, their average outcome is 60. If they are not treated, their average outcome is 40.

Assume there are no Defiers.

  a) Calculate the four key quantities for the Wald estimator: $E[Y | Z=1]$, $E[Y | Z=0]$, $E[X | Z=1]$, and $E[X | Z=0]$.
  
  b) Using these values, compute the treatment effect using the Wald estimator formula: $\hat{\beta}_{\text{Wald}} = \frac{E[Y | Z=1] - E[Y | Z=0]}{E[X | Z=1] - E[X | Z=0]}$.
  
  c) What is the Local Average Treatment Effect (LATE) for this population? How does it compare to your result from part (b)?

## The Danger of Weak Instruments

The lecture notes state that the approximate bias of the IV estimator is $Bias(\hat{\beta}_{IV}) \approx \frac{Cov(Z, \epsilon)}{Cov(Z, X)}$.

a) Using this formula, explain intuitively why a "weak instrument" (an instrument with low relevance) can lead to a very large bias in the IV estimate, even if the exclusion restriction is only violated by a tiny amount (i.e., $Cov(Z, \epsilon)$ is very close to, but not exactly, zero).

b) In practice, how do researchers test for weak instruments? What is the common rule of thumb for the relevant test statistic?

## Understanding 2SLS

Consider a model to estimate the effect of endogenous police numbers ($X_i$) on the crime rate ($Y_i$), controlling for the poverty level ($W_i$). You have two instruments for police numbers: the number of firefighters in the city ($Z_{1i}$) and whether it was a mayoral election year ($Z_{2i}$).

The structural model is: $Y_i = \beta_0 + \beta_1 X_i + \gamma_1 W_i + \epsilon_i$.

  a) Write down the equation for the **First Stage** regression of the 2SLS procedure. What are the dependent and independent variables?
  
  b) Write down the equation for the **Second Stage** regression. What is the key difference between the regressor of interest in this stage versus the structural model?
  
  c) The lecture notes that you should not perform these two regressions manually because the standard errors from the second stage will be incorrect. Briefly explain why this is the case. *(Hint: Think about the uncertainty involved in the first stage).*

